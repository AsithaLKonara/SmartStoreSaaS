version: '3.8'

services:
  # API Gateway
  api-gateway:
    image: smartstore-api-gateway:latest
    ports:
      - "3001:3000"
    environment:
      - NODE_ENV=production
      - JWT_SECRET=smartstore-jwt-secret-2024
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # User Service
  user-service:
    image: smartstore-user-service:latest
    environment:
      - NODE_ENV=production
      - JWT_SECRET=smartstore-jwt-secret-2024
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Product Service
  product-service:
    image: smartstore-product-service:latest
    environment:
      - NODE_ENV=production
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3002/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Order Service
  order-service:
    image: smartstore-order-service:latest
    environment:
      - NODE_ENV=production
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3003/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Payment Service
  payment-service:
    image: smartstore-payment-service:latest
    environment:
      - NODE_ENV=production
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3004/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Inventory Service
  inventory-service:
    image: smartstore-inventory-service:latest
    environment:
      - NODE_ENV=production
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3005/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Notification Service
  notification-service:
    image: smartstore-notification-service:latest
    environment:
      - NODE_ENV=production
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3006/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Analytics Service
  analytics-service:
    image: smartstore-analytics-service:latest
    environment:
      - NODE_ENV=production
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3007/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # AI/ML Service
  ai-ml-service:
    image: smartstore-ai-ml-service:latest
    environment:
      - NODE_ENV=production
    networks:
      - smartstore-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3008/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Search Service
  search-service:
    image: smartstore-search-service:latest
    environment:
      - NODE_ENV=production
    networks:
      - smartstore-network

  # File Service
  file-service:
    image: smartstore-file-service:latest
    environment:
      - NODE_ENV=production
    networks:
      - smartstore-network

  # Blockchain Service
  blockchain-service:
    image: smartstore-blockchain-service:latest
    environment:
      - NODE_ENV=production
    networks:
      - smartstore-network

  # IoT Service
  iot-service:
    image: smartstore-iot-service:latest
    environment:
      - NODE_ENV=production
    networks:
      - smartstore-network

  # Redis (reuse existing)
  redis:
    image: redis:7.2-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    networks:
      - smartstore-network

networks:
  smartstore-network:
    external: true

volumes:
  redis_data: 